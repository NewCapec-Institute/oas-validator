<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" >
<head>
  <meta content="text/html;charset=UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>The OpenAPI Specification Tools - Compatibility Validator</title>

  <link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.css}" rel="stylesheet">
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <!-- Navbar content -->
    <a class="navbar-brand" href="#">树维 Supwisdom</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#" th:href="@{/}">首页</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" th:href="@{/viewer}">查看器</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" th:href="@{/editor}">编辑器</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="#" th:href="@{/validator}">验证器 <span class="sr-only">(current)</span></a>
        </li>
      </ul>
    </div>
  </nav>
  
  <div style="height: 50px;"></div>

  <div class="container">

    <h2>兼容性检查</h2>
    <span>对新旧两个版本的OAS做兼容性检查。</span><br/>
    <span>OAS可以使用[<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#reference-object" target="_blank">Reference Object</a>]来描述Spec，两个不同的OAS会出现描述不同但语义相同的情况。</span>
      <div class="" style="height: 20px;"></div>
    
    <div>
      <textarea name="leftYaml" placeholder="旧 OpenAPI Document（yaml）" style="width: 40%; height: 480px;"></textarea>
      <textarea name="rightYaml" placeholder="新 OpenAPI Document（yaml）" style="width: 40%; height: 480px;"></textarea>
      <div>
      <button id="compatibilityValidate" class="btn btn-info">兼容性检查</button>
      </div>
    </div>
  
    <div class="" style="height: 20px;"></div>
  
  </div>

  <script type="text/javascript" src="" th:src="@{/webjars/jquery/3.0.0/jquery.js}"></script>
  <script type="text/javascript" src="" th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.js}"></script>
  
  <script type="text/javascript">
  $(function(){
    
    $('#compatibilityValidate').on('click', function(e) {
      var url = "/api/compatibility";
  
      var rightYaml = $('textarea[name="rightYaml"]').val(); if (rightYaml=="") {return;}
      var leftYaml = $('textarea[name="leftYaml"]').val(); if (leftYaml=="") {return;}
      
      var data = leftYaml + "\n---\n" + rightYaml;
      
      post(url, data, function(json) {
        console.log(json);
        
        
      });
    });
  
  });
  
  function post(url, data, cb) {// application/json // text/plain
    
    $.ajax({
      url: url, 
      data: data,
      type: 'post',
      headers: {
        "Accept": "application/json; charset=utf-8", 
        "Content-Type": "text/plain; charset=utf-8"
      },
      success: function(json) {
        cb(json);
      }
    });
    
  }
  
  </script>

</body>

</html>
